---
title: "Youth unemployment and turnout in Spain"
author: "Rafael Goldzweig & Rita Alvarez"
date: "December 2, 2016"
output:
  pdf_document:
    number_sections: yes
    toc: yes
  word_document:
    toc: yes
header-includes:
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \fancyhead[LO,LE]{Youth unemployment and turnout in Spain}
- \fancyfoot[LO,LE]{Final Data Project}
- \fancyfoot[RE,RO]{Rafael Goldzweig & Rita Alvarez}
subtitle: Final Data Project
bibliography: References.bib
---

```{r options, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(message = FALSE)
# opts_chunk$set(tidy=FALSE)
# opts_chunk$set(fig.path='figs/', cache.path='cache/graphics-', 
#         fig.align='center', fig.width = 5, fig.height = 5, fig.show = 'hold',
#         cache = TRUE, par = TRUE)
```

```{r library, message=FALSE, echo=FALSE, include=FALSE}
library(pxR)
library(MicroDatosEs)
library(XML)
library(zoo)
library(rvest)
library(dplyr)
library(magrittr)
library(foreign)
library(readxl)
library(xlsx)
library(ggplot2)
library(pastecs)
library(stargazer)
```

```{r setup, message=FALSE, echo=FALSE, include=FALSE}
# Clear Global environment
rm(list=ls())

# set WD
setwd('C:/Users/Schmuziger/Desktop/Final Data Project')
```

```{r turnout data, results='asis', tidy=TRUE, echo=FALSE}
# Read Turnout data

Turnout2004_2008_2011_2015 <- read_excel("C:/Users/Schmuziger/Desktop/Assignment-3/ElectionsResult_2015_2011_2008_2004.xlsx", col_names = TRUE)
```

```{r unemployment data, results='asis', tidy=TRUE, echo=FALSE}
# Read Unemployment data

YouthUnemployment2004_2015 <- read_excel("C:/Users/Schmuziger/Desktop/Assignment-3/YouthUnemployment2015_2011_2008_2004.xlsx", col_names = TRUE)
```

```{r dataset, results='asis', tidy=TRUE, echo=FALSE}
# Merge the dataset of electoral results with the dataset of unemployment rates. Change columns as numeric and clean one column

Spain_data <- merge(Turnout2004_2008_2011_2015, YouthUnemployment2004_2015, by=c("Region","Year"), all=TRUE)

Spain_data$Unempl_rate_total<- as.numeric(Spain_data$Unempl_rate_total)
Spain_data$Unempl_rate_less25 <- as.numeric(Spain_data$Unempl_rate_less25)
Spain_data$Unempl_rate_16_19 <- as.numeric(Spain_data$Unempl_rate_16_19)
Spain_data$Unempl_rate_20_24 <- as.numeric(Spain_data$Unempl_rate_20_24)

Spain_data <- Spain_data[, -c(7,7)]

# Create category to divide rich regions from poor regions in Spain

Spain_data["Rich"] <- 1 

Spain_data$Rich <- ifelse(Spain_data$Region == 'Extremadura', 0, ifelse(Spain_data$Region == 'Castilla_la_Mancha', 0, ifelse(Spain_data$Region == 'Murcia', 0, ifelse(Spain_data$Region == 'Canarias', 0, ifelse(Spain_data$Region == 'Galicia', 0, ifelse(Spain_data$Region == 'Comunitat_Valenciana', 0, ifelse(Spain_data$Region == 'Melilla', 0, ifelse(Spain_data$Region == 'Asturias', 0, ifelse(Spain_data$Region == 'Ceuta', 0, ifelse(Spain_data$Region == 'Castilla_y_Leon', 0, ifelse(Spain_data$Region == 'Andalucia', 0, 1)))))))))))
```

## Basic descriptive statistics

```{r 1, results='asis', tidy=TRUE, echo=FALSE, include=FALSE}
stat.desc(Spain_data) 
m <- stat.desc(Spain_data, basic=F)
m <- m[, -c(1:2)]
```


```{r stargazer, results='asis', tidy=TRUE, echo=FALSE, header = FALSE}
stargazer(m)
```

We are looking at tunout from general elections in Spain that occured in the years 2004, 2008, 2011 and 2015. The elections in 2015 did not result in the formation of government due to a highly fragmented parlament and the general elections were reperated in 2016. However, we decided to use only the data from the 2015 election since in a second call people might turn or not to turn to vote for different reasons than in normal elections.  The average turnout rate in Spain in these years (2004, 2008, 2011, 2015) was 72.02%. This is a pretty high turnout rate for a developed country that does not have compulsory voting. However, the differences across regions would be notable. Another thing to highlight from the table above is that invalid votes are in general more casted than blank votes.

When looking at unemployemnt rates it is clear that the average youth unemployment rate is much higher than the average total unemployment rate in years 2004, 2008, 2011 and 2015. Average youth unemployment rates increase drastically as the age of the populations groups studied lowers. Also, the standard deviation of the mean unemployment rate is higher for youth unemployemnt rate than for the normal unemployment rate indicating that youth unemployment varied more from year 2004 to year 2015.

##Turnout

```{r plot turnout, fig.width=8, fig.height=6, echo=FALSE}
ggplot(Spain_data, aes(x = Region, y = Turnout)) + geom_line()
```

The plot shows the variability of tunout by region in Spain. The regions that have lower turnout during the years 2004-2015 were Ceuta, Melilla, Baleares and Canarias. Ceuta and Melilla and autonomous cities that are phisically in Moroccan territory and Baleares and Canarias are islands. This gives the hint that people living in this regions might feel less attached to the Central government and therefore they vote less. It is also interesting to observe that the regions with a second official language different than Spanish, Catalunya, Galicia and Pais Vasco tend to have also lower turnout rates in the period.

##Unemployment

```{r plot unemployment, fig.width=8, fig.height=6, echo=FALSE}
ggplot(Spain_data, aes(x = Region, y = Unempl_rate_less25)) + geom_line()
```

Youth unemployment rates show a wide range during the period 2004-2015. Youth unemployment rates are structurally high in Spain. However, after the beginning of the economic crisis in 2008, youth unemployment rates explode. They went from around 20% in most regions to nearly 50%. However, Ceuta and Melilla stand out for their extremely high youth unemployment rates both before and after the economic crisis. The following graphs show that the youth unemployment rate is higher the lower is the age of the population studied.

```{r echo = FALSE, out.width=c('300px', '300px'), fig.show='hold'} 

```

```{r plot region 1, fig.width=8, fig.height=5, echo=FALSE, warning=FALSE}
# include map

region_code <- c("AN", "AR", "AS", "IB", "IC", "CA", "CM", "CL", "CT", "CE", "CV", "EX", "GA", "LR", "MA", "ME", "MU", "NV", "PV")

region_name <- c("Andalucia", "Aragon", "Asturias", "Baleares", "Canarias", "Cantabria", "Castilla_La_Mancha", "Castilla_y_Leon", "Catalunya", "Ceuta", "Comunitat_Valenciana", "Extremadura", "Galicia", "La_Rioja", "Madrid", "Melilla", "Murcia", "Navarra", "Pais_Vasco")

ggplot(data=Spain_data, aes(x=Year, y=Unempl_rate_20_24, group = Region, colour = Region)) + geom_line() + ggtitle("Youth Unemployment per region") + labs(x="Year", y="Unemployment rate 20-24") + 
ggtitle("Youth Unemployment per region 2004-2015")+ scale_color_discrete(labels = region_code)
+ theme(legend.position = "bottom", legend.key = element_rect(size = 5, fill = 'white', colour = 'white'), legend.key.size = unit(2.0, 'lines'), axis.title.y=element_text(margin=margin(10,10,0,10)))
```


```{r plot region 2, fig.width=8, fig.height=5, echo=FALSE, warning=FALSE}
# include map
```

## Unemployment and turnout

Spain_data["Mean_Unemp_Rate_less25"] <- NA 

Spain_data <- within(Spain_data, est[b==0] <- (a[b==0]-5)/2.533)

YouthUnemployment2004_2015$Mean_Unemp_Rate_less25 <- rowMeans(Unempl_rate_less25[,1:4])

```{r unemp turn, fig.width=8, fig.height=6, echo=FALSE, warning=FALSE}
plot(Spain_data$Unempl_rate_total, Spain_data$turnout)

# Add aesthetic mappings

p <- ggplot(Spain_data, aes(Unempl_rate_less25, Turnout))
p + geom_point()
p1<-p + geom_point(aes(colour = Region)) 
p3 <- p1 + labs(y="Turnout", x= "Youth Unemployment")
p5 <- p3 + scale_y_continuous("Turnout",
                              limits=c(0.4,0.85),
                              breaks=seq(0.4, 0.85, 0.2)) + stat_smooth(method = 'lm', aes(colour = Region), se = FALSE)
p5

p6<-p5 + theme(axis.text.x = element_blank())
p6



# Unemployment and Turnout between Rich and Poor Regions

p <- ggplot(Spain_data, aes(Unempl_rate_less25, Turnout))
p + geom_point()
p1<-p + geom_point(aes(colour = Rich)) 
p3 <- p1 + labs(y="Turnout", x= "Youth Unemployment")
p5 <- p3 + scale_y_continuous("Turnout",
                              limits=c(0.4,0.85),
                              breaks=seq(0.4, 0.85, 0.2)) + stat_smooth(method = 'lm', aes(group = Rich), se = TRUE)
p5

Spain_data["Year_character"] <- as.character(Spain_data$Year)

# HIGHLIGHT SOME REGIONS WITH COLORS FOR YEARS

p <- ggplot(Spain_data, aes(Unempl_rate_less25, Turnout))
p + geom_point()
p1 <- p + geom_point(aes(colour = Year_character, group=highlight)) + 
  scale_colour_identity()
p3 <- p1 + labs(y="Turnout", x= "Youth Unemployment")
p5 <- p3 + scale_y_continuous("Turnout",
                              limits=c(0.4,0.85),
                              breaks=seq(0.4, 0.85, 0.2)) + stat_smooth(method = 'lm', aes(colour = Year_character, group=highlight), se = FALSE)
p5

p6<-p5 + theme(axis.text.x = element_blank())

p6

# LINEAR BETWEEN YEARS

p <- ggplot(Spain_data, aes(Unempl_rate_less25, Turnout))
p + geom_point()
p1 <- p + geom_point(aes(colour = Year_character)) + 
  scale_colour_identity()
p3 <- p1 + labs(y="Turnout", x= "Youth Unemployment")
p5 <- p3 + scale_y_continuous("Turnout",
                              limits=c(0.4,0.85),
                              breaks=seq(0.4, 0.85, 0.2)) + stat_smooth(method = 'lm', aes(colour = Year_character), se = FALSE)
p5

p6<-p5 + theme(axis.text.x = element_blank())

p6

# ORIGINAL - COLORS PER REGION AND LINES

p <- ggplot(Spain_data, aes(Unempl_rate_less25, Turnout))
p + geom_point()
p1<-p + geom_point(aes(colour = Region)) 
p3 <- p1 + labs(y="Turnout", x= "Youth Unemployment")
p5 <- p3 + scale_y_continuous("Turnout",
                              limits=c(0.4,0.85),
                              breaks=seq(0.4, 0.85, 0.2)) + stat_smooth(method = 'lm', aes(colour = Region), se = FALSE)
p5

p6<-p5 + theme(axis.text.x = element_blank())
p6


p6<-p5 + theme(axis.text.x = element_blank())
p6

p <- ggplot(Spain_data, aes(Unempl_rate_less25, Turnout))
p + geom_point()
p1<-p + geom_point(aes(x=a[c(1,3],y=b[c(1, 3)]),colour="red")
p3 <- p1 + labs(y="Turnout", x= "Youth Unemployment")
p5 <- p3 + scale_y_continuous("Turnout",
                              limits=c(0.4,0.85),
                              breaks=seq(0.4, 0.85, 0.2)) + stat_smooth(method = 'lm', aes(colour = Region), se = FALSE)
p5

p6<-p5 + theme(axis.text.x = element_blank())
p6

ggplot(Spain_data, aes(Turnout, Unempl_rate_less25) + geom_point(1) + stat_smooth(se = FALSE) + theme_bw()
```

This plot shows how tunout and youth unemploment rate could be correlated. The plot shows that the correlation is not clear. 

The graphs are not showing the potential correlation by region that may exist between unemployment and turnout, an information that could give us a different perspective on the issue. Therefore, we need to explore this dataset further in order to conclude which is the relationship between turnout and youth unemployment rate in Spain.
