
---
title: "Regression"
author: "Rita Alvarez and Rafael Schmuziger"
date: "November 11, 2016"
output: pdf_document
---

```{r options, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(message = FALSE)
# opts_chunk$set(tidy=FALSE)
# opts_chunk$set(fig.path='figs/', cache.path='cache/graphics-', 
#         fig.align='center', fig.width = 5, fig.height = 5, fig.show = 'hold',
#         cache = TRUE, par = TRUE)
```

```{r library, message=FALSE, echo=FALSE, include=FALSE}
library(pxR)
library(MicroDatosEs)
library(XML)
library(zoo)
library(rvest)
library(dplyr)
library(magrittr)
library(foreign)
library(readxl)
library(ggplot2)
library(pastecs)
library(stargazer)
```


```{r set wd, message=FALSE, echo=FALSE, include=FALSE}
setwd('C:/Users/Rita/Desktop/Final-Data-Project')

rm(list=ls())
```

```{r turnout data, results='asis', tidy=TRUE, echo=FALSE}
# Read Turnout data

Turnout2004_2008_2011_2015 <- read_excel("C:/Users/Rita/Desktop/Assignment-3/ElectionsResult_2015_2011_2008_2004.xlsx", col_names = TRUE)
```

```{r unemployment data, results='asis', tidy=TRUE, echo=FALSE}
# Read Unemployment data

YouthUnemployment2004_2015 <- read_excel("C:/Users/Rita/Desktop/Assignment-3/YouthUnemployment2015_2011_2008_2004.xlsx", col_names = TRUE)
```

```{r dataset, results='asis', tidy=TRUE, echo=FALSE}
# Merge the dataset of electoral results with the dataset of unemployment rates. Change columns as numeric and clean one column

Spain_data <- merge(Turnout2004_2008_2011_2015, YouthUnemployment2004_2015, by=c("Region","Year"), all=TRUE)

Spain_data$Unempl_rate_total<- as.numeric(Spain_data$Unempl_rate_total)
Spain_data$Unempl_rate_less25 <- as.numeric(Spain_data$Unempl_rate_less25)
Spain_data$Unempl_rate_16_19 <- as.numeric(Spain_data$Unempl_rate_16_19)
Spain_data$Unempl_rate_20_24 <- as.numeric(Spain_data$Unempl_rate_20_24)

Spain_data <- Spain_data[, -c(7,7)]

Spain_data["Rich"] <- 1 

Spain_data$Rich <- ifelse(Spain_data$Region == 'Extremadura', 0, ifelse(Spain_data$Region == 'Castilla_la_Mancha', 0, ifelse(Spain_data$Region == 'Murcia', 0, ifelse(Spain_data$Region == 'Canarias', 0, ifelse(Spain_data$Region == 'Galicia', 0, ifelse(Spain_data$Region == 'Comunitat_Valenciana', 0, ifelse(Spain_data$Region == 'Melilla', 0, ifelse(Spain_data$Region == 'Asturias', 0, ifelse(Spain_data$Region == 'Ceuta', 0, ifelse(Spain_data$Region == 'Castilla_y_Leon', 0, ifelse(Spain_data$Region == 'Andalucia', 0, 1)))))))))))
```



In our basic model we want to see what is the relationship between youth unemployment and voter turnout in General Election in Spain.For this we use the following equation:

$$
Turnout_{it}= \beta_{0}+\beta_{1}Youth\ Unemployment\ Rate_{it}+\epsilon_{it}
$$
where $i$ represents each of the 17 regions plus two Autonomous cities of Spain and $t$ represents each of the years we have data for $t={2004, 2008, 2011, 2015}$

```{r basic, results='asis', tidy=TRUE, echo=FALSE}
Reg1 <- lm(Turnout ~ Unempl_rate_less25, data = Spain_data)
```
plot(Reg1,which=1)

```{r summary1, results='asis', tidy=TRUE, echo=FALSE}
summary(Reg1)
```

```{r stargazer, results='asis', tidy=TRUE, echo=FALSE, header=FALSE}
stargazer(Reg1, 
          title            = "Basic Regression",
          covariate.labels = c("Youth Unemloyment", "Constant"),
          dep.var.labels   = "Voter Turnout in General Elections")
```

Our analysis can also go one step further and iclude regional fixed effects 
$$
Turnout_{it}= \beta_{0}+\beta_{1}Youth\ Unemployment\ Rate_{it}+\delta_{i} + \epsilon_{it}
$$

```{r}
Reg2 <- lm(Turnout ~ Unempl_rate_less25 + Region, data = Spain_data)
```

```{r}
summary(Reg2)
```

```{r stargazer2, results='asis', tidy=TRUE, echo=FALSE, header = FALSE}
stargazer(Reg1, Reg2)
```

```{r create dummy, results='asis', tidy=TRUE, echo=FALSE}
# Create one dummy for each year
Spain_data["four"] <- as.numeric(Spain_data$Year == 2004)
Spain_data["eight"] <- as.numeric(Spain_data$Year == 2008)
Spain_data["eleven"] <- as.numeric(Spain_data$Year == 2011)
Spain_data["fifteen"] <- as.numeric(Spain_data$Year == 2015)
```

```{r}
Reg3 <- lm(Turnout ~ Unempl_rate_less25 + eight + eleven + fifteen, data = Spain_data)
```

```{r}
summary(Reg3)
```

```{r stargazer3, results='asis', tidy=TRUE, echo=FALSE, header = FALSE}
stargazer(Reg1, Reg3)
```

```{r stargazer4, results='asis', tidy=TRUE, echo=FALSE, header = FALSE}
stargazer(Reg1, Reg2, Reg3)
```

```{r plot, results='asis', tidy=TRUE, echo=FALSE}
coplot(Unempl_rate_less25 ~ Year|Region, type="l", data=Spain_data) # Lines
coplot(Unempl_rate_less25 ~ Year|Region, type="b", data=Spain_data) # Points and
```

 