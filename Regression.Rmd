
---
title: "Regression"
author: "Rita Alvarez and Rafael Schmuziger"
date: "November 11, 2016"
output: pdf_document
---

```{r options, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(message = FALSE)
# opts_chunk$set(tidy=FALSE)
# opts_chunk$set(fig.path='figs/', cache.path='cache/graphics-', 
#         fig.align='center', fig.width = 5, fig.height = 5, fig.show = 'hold',
#         cache = TRUE, par = TRUE)
```

```{r library, message=FALSE, echo=FALSE, include=FALSE}
library(pxR)
library(MicroDatosEs)
library(XML)
library(zoo)
library(rvest)
library(dplyr)
library(magrittr)
library(foreign)
library(readxl)
library(ggplot2)
library(pastecs)
library(stargazer)
library(gplots)
```


```{r set wd, message=FALSE, echo=FALSE, include=FALSE}
setwd('C:/Users/Rita/Desktop/Final-Data-Project')
```

```{r turnout data, results='asis', tidy=TRUE, echo=FALSE}
# Read Turnout data

Turnout2004_2008_2011_2015 <- read_excel("C:/Users/Rita/Desktop/Assignment-3/ElectionsResult_2015_2011_2008_2004.xlsx", col_names = TRUE)
```

```{r unemployment data, results='asis', tidy=TRUE, echo=FALSE}
# Read Unemployment data

YouthUnemployment2004_2015 <- read_excel("C:/Users/Rita/Desktop/Assignment-3/YouthUnemployment2015_2011_2008_2004.xlsx", col_names = TRUE)
```

```{r dataset, results='asis', tidy=TRUE, echo=FALSE}
# Merge the dataset of electoral results with the dataset of unemployment rates. Change columns as numeric and clean one column

Spain_data <- merge(Turnout2004_2008_2011_2015, YouthUnemployment2004_2015, by=c("Region","Year"), all=TRUE)

Spain_data$Unempl_rate_total<- as.numeric(Spain_data$Unempl_rate_total)
Spain_data$Unempl_rate_less25 <- as.numeric(Spain_data$Unempl_rate_less25)
Spain_data$Unempl_rate_16_19 <- as.numeric(Spain_data$Unempl_rate_16_19)
Spain_data$Unempl_rate_20_24 <- as.numeric(Spain_data$Unempl_rate_20_24)

Spain_data <- Spain_data[, -c(7,7)]

Spain_data["Rich"] <- 1 

Spain_data$Rich <- ifelse(Spain_data$Region == 'Extremadura', 0, ifelse(Spain_data$Region == 'Castilla_la_Mancha', 0, ifelse(Spain_data$Region == 'Murcia', 0, ifelse(Spain_data$Region == 'Canarias', 0, ifelse(Spain_data$Region == 'Galicia', 0, ifelse(Spain_data$Region == 'Comunitat_Valenciana', 0, ifelse(Spain_data$Region == 'Melilla', 0, ifelse(Spain_data$Region == 'Asturias', 0, ifelse(Spain_data$Region == 'Ceuta', 0, ifelse(Spain_data$Region == 'Castilla_y_Leon', 0, ifelse(Spain_data$Region == 'Andalucia', 0, 1)))))))))))

Spain_data$Region_code <- ifelse(Spain_data$Region == 'Extremadura', 'EX', ifelse(Spain_data$Region == 'Castilla_La_Mancha', 'CM', ifelse(Spain_data$Region == 'Murcia', 'MU', ifelse(Spain_data$Region == 'Canarias', 'IC', ifelse(Spain_data$Region == 'Galicia', 'GA', ifelse(Spain_data$Region == 'Comunitat_Valenciana', 'CV', ifelse(Spain_data$Region == 'Melilla', 'ME', ifelse(Spain_data$Region == 'Asturias', 'AS', ifelse(Spain_data$Region == 'Ceuta', 'CE', ifelse(Spain_data$Region == 'Castilla_y_Leon', 'CL', ifelse(Spain_data$Region == 'Andalucia', 'AN', ifelse(Spain_data$Region == 'Cantabria', 'CA', ifelse(Spain_data$Region == 'Baleares', 'IB', ifelse(Spain_data$Region == 'Aragon', 'AR', ifelse(Spain_data$Region == 'Catalunya', 'CT', ifelse(Spain_data$Region == 'Madrid', 'MA', ifelse(Spain_data$Region == 'Navarra', 'NV', ifelse(Spain_data$Region == 'Pais_Vasco', 'PV', ifelse(Spain_data$Region == 'La_Rioja', 'LR', NA)))))))))))))))))))
```



In our basic model we want to see what is the relationship between youth unemployment and voter turnout in General Election in Spain.For this we use the following equation:

$$
Turnout_{it}= \beta_{0}+\beta_{1}Youth\ Unemployment\ Rate_{it}+\epsilon_{it}
$$
where $i$ represents each of the 17 regions plus two Autonomous cities of Spain and $t$ represents each of the years we have data for $t={2004, 2008, 2011, 2015}$

```{r basic, results='asis', tidy=TRUE, echo=FALSE}
Reg1 <- lm(Turnout ~ Unempl_rate_less25, data = Spain_data)
```

```{r basic, results='asis', tidy=TRUE, echo=FALSE}
plot(Reg1,which=1)
```

```{r basic, results='asis', tidy=TRUE, echo=FALSE}
plot(Reg1,which=2)
```

```{r summary1, results='asis', tidy=TRUE, echo=FALSE}
summary(Reg1)
```

```{r stargazer, results='asis', tidy=TRUE, echo=FALSE, header=FALSE}
stargazer(Reg1, 
          title            = "Basic Regression",
          covariate.labels = c("Youth Unemloyment", "Constant"),
          dep.var.labels   = "Voter Turnout in General Elections")
```

Our analysis can also go one step further and iclude regional fixed effects 
$$
Turnout_{it}= \beta_{0}+\beta_{1}Youth\ Unemployment\ Rate_{it}+\delta_{i} + \epsilon_{it}
$$

```{r fix, results='asis', tidy=TRUE, echo=FALSE}
Reg2 <- lm(Turnout ~ Unempl_rate_less25 + Region, data = Spain_data)
```

```{r}
summary(Reg2)
```

```{r stargazer2, results='asis', tidy=TRUE, echo=FALSE, header = FALSE}
stargazer(Reg1, Reg2, header=FALSE)
```

```{r create dummy, results='asis', tidy=TRUE, echo=FALSE}
# Create one dummy for each year
Spain_data["four"] <- as.numeric(Spain_data$Year == 2004)
Spain_data["eight"] <- as.numeric(Spain_data$Year == 2008)
Spain_data["eleven"] <- as.numeric(Spain_data$Year == 2011)
Spain_data["fifteen"] <- as.numeric(Spain_data$Year == 2015)
```

```{r}
Reg3 <- lm(Turnout ~ Unempl_rate_less25 + eight + eleven + fifteen, data = Spain_data)
```

```{r}
summary(Reg3)
```

```{r stargazer3, results='asis', tidy=TRUE, echo=FALSE, header = FALSE}
stargazer(Reg1, Reg3)
```

```{r stargazer4, results='asis', tidy=TRUE, echo=FALSE, header = FALSE}
stargazer(Reg1, Reg2, Reg3)
```

Spain_data["unempl_rich"]<-Spain_data$Unempl_rate_less25*Spain_data$Rich

```{r}
Spain_data["unempl_rich"]<-Spain_data$Unempl_rate_less25*Spain_data$Rich
Reg4 <- lm(Turnout ~ Unempl_rate_less25 + Rich + unempl_rich, data = Spain_data)
```

```{r}
summary(Reg4)
```

```{r plot, results='asis', tidy=TRUE, echo=FALSE}
coplot(Unempl_rate_less25 ~ Year|Region, type="l", data=Spain_data) # Lines
coplot(Unempl_rate_less25 ~ Year|Region, type="b", data=Spain_data) # Points and
```


```{r plot1,fig.width=10, fig.height=6, results='asis', tidy=TRUE, echo=FALSE}
boxplot(Turnout ~ Region_code, main="Heterogeineity across regions", data=Spain_data)
``` 

```{r plot2, fig.width=10, fig.height=6, results='asis', tidy=TRUE, echo=FALSE}
Boxplot(Turnout ~ Year, main="Heterogeineity across years", data=Spain_data)
``` 

```{r plot3, results='asis', tidy=TRUE, echo=FALSE}
region_code <- c("AN", "AR", "AS", "IB", "IC", "CA", "CM", "CL", "CT", "CE", "CV", "EX", "GA", "LR", "MA", "ME", "MU", "NV", "PV")

region_name <- c("Andalucia", "Aragon", "Asturias", "Baleares", "Canarias", "Cantabria", "Castilla_La_Mancha", "Castilla_y_Leon", "Catalunya", "Ceuta", "Comunitat_Valenciana", "Extremadura", "Galicia", "La_Rioja", "Madrid", "Melilla", "Murcia", "Navarra", "Pais_Vasco")

region.code.short <- substr(region_code, 1, 19)

ggplot(data=Spain_data, aes(x=Year, y=Unempl_rate_20_24, group = Region, colour = Region)) + geom_line() + ggtitle("Youth Unemployment per region") + 
 labs(x="Year", y="Unemployment rate 20-24") + 
 ggtitle("Youth Unemployment per region 2004-2015") + 
 scale_color_discrete(labels = region_code) + 
 theme(legend.position = "bottom", legend.key = element_rect(size = 5, fill = 'white', colour = 'white'), legend.key.size = unit(2.0, 'lines'), axis.title.y=element_text(margin=margin(10,10,0,10)))
``` 

